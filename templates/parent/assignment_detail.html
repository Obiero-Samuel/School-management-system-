{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h2>Assignment: {{ assignment.title }}</h2>
  <p><strong>Subject:</strong> {{ assignment.subject }}</p>
  <p><strong>Description:</strong> {{ assignment.description }}</p>
  <p><strong>Due Date:</strong> {{ assignment.due_date }}</p>
  <p><strong>Status:</strong> {{ submission.status if submission else 'Not Submitted' }}</p>
  {% if submission and submission.file_path %}
    <p><strong>Your Submission:</strong> <a href="{{ url_for('download_assignment_file', submission_id=submission.id) }}">Download</a></p>
    <p><strong>Grade:</strong> {{ grade.marks_obtained }}/{{ grade.total_marks }}<br><strong>Feedback:</strong> {{ grade.teacher_feedback }}</p>
  {% elif assignment.due_date >= now %}
    <form action="{{ url_for('parent_submit_assignment', assignment_id=assignment.id, child_id=child.id) }}" method="post" enctype="multipart/form-data">
      <div class="mb-3">
        <label for="file" class="form-label">Upload Submission</label>
        <input type="file" class="form-control" name="file" id="file" required>
      </div>
      <button type="submit" class="btn btn-success">Submit</button>
    </form>
  {% else %}
    <p class="text-danger">Submission closed.</p>
  {% endif %}
  <hr>
  <h4>Reviews</h4>
  <ul class="list-group">
    {% for review in reviews %}
    <li class="list-group-item">
      <strong>{{ review.reviewer_type|capitalize }}:</strong> {{ review.review_text }}
      <span class="text-muted">({{ review.created_at }})</span>
      {% if review.rating %}<span class="badge bg-info">Rating: {{ review.rating }}</span>{% endif %}
    </li>
    {% else %}
    <li class="list-group-item">No reviews yet.</li>
    {% endfor %}
  </ul>
  <hr>
  <form action="{{ url_for('parent_add_review', assignment_id=assignment.id, child_id=child.id) }}" method="post">
    <div class="mb-3">
      <label for="review_text" class="form-label">Add Your Review</label>
      <textarea class="form-control" name="review_text" id="review_text" required></textarea>
    </div>
    <div class="mb-3">
      <label for="rating" class="form-label">Rating (optional)</label>
      <input type="number" class="form-control" name="rating" id="rating" min="1" max="5">
    </div>
    <button type="submit" class="btn btn-primary">Submit Review</button>
  </form>
</div>
{% endblock %}